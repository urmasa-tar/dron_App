{% extends "base.html" %}

{% block content %}
<div class="container drone-detail">
    <h1>{{ drone.name }} <span class="badge badge-{{ 'success' if drone.status == 'connected' else 'secondary' }}">
        {{ drone.status }}
    </span></h1>
    
    <div class="drone-info">
        <p><strong>IP:</strong> {{ drone.ip }}</p>
        <p><strong>MAVLink порт:</strong> {{ drone.port }}</p>
        <p><strong>ROS порт:</strong> {{ drone.ros_port }}</p>
        <p><strong>Добавлен:</strong> {{ drone.added_at }}</p>
    </div>
    
    <div class="drone-actions">
        <button class="btn btn-connect" 
                onclick="connectDrone({{ drone.id }})"
                {{ 'disabled' if drone.status == 'connected' }}>
            Подключить
        </button>
        
        <a href="/download/launch/{{ drone.name }}" class="btn btn-download">
            Скачать launch-файл
        </a>
    </div>
</div>

<script>
function connectDrone(droneId) {
    fetch(`/api/drone/${droneId}/connect`, {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        if(data.success) {
            alert(`Дрон подключен. PID процесса: ${data.pid}`);
            window.location.reload();
        } else {
            alert(`Ошибка: ${data.error}`);
        }
    });
}
</script>
{% endblock %}