{% extends "base.html" %}

{% block content %}
<div class="drone-detail-container status-{{ drone.status }}">
    <!-- Заголовок -->
    <div class="drone-header">
        <a href="{{ url_for('website.index') }}" class="back-link">← Назад к списку</a>
        <h1>{{ drone.name }}</h1>
        <span class="status-badge status-{{ drone.status }}">
            {% if drone.status == 'idle' %}Готов{% elif drone.status == 'busy' %}В работе{% else %}Оффлайн{% endif %}
        </span>
    </div>

    <!-- Основная информация -->
    <div class="drone-info">
        <div class="info-card">
            <h3>Технические данные</h3>
            <div class="info-row">
                <span>ID:</span>
                <strong>#{{ drone.id }}</strong>
            </div>
            <div class="info-row">
                <span>IP адрес:</span>
                <strong>{{ drone.ip }}</strong>
            </div>
        </div>

        <div class="info-card">
            <h3>Состояние</h3>
            <div class="info-row">
                <span>Батарея:</span>
                <div class="battery-container">
                    <div class="battery-level" style="width: {{ drone.get('battery', 0) }}%;"></div>
                    <span class="battery-value">{{ drone.get('battery', 0) }}%</span>
                </div>
            </div>
            <div class="info-row">
                <span>Статус:</span>
                <strong class="status-text">{{ drone.status }}</strong>
            </div>
        </div>
    </div>

    <!-- Управление -->
    <div class="control-panel">
        <button class="control-btn takeoff-btn" onclick="sendDroneCommand('takeoff')">
            Взлет
        </button>
        <button class="control-btn land-btn" onclick="sendDroneCommand('land')">
            Посадка
        </button>
        <button class="control-btn emergency-btn" onclick="confirmEmergencyStop()">
            Аварийная остановка
        </button>
    </div>
</div>

<script>
function sendDroneCommand(command) {
    fetch(`/api/drone/{{ drone.id }}/${command}`, {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        alert(data.message || "Команда выполнена");
    })
    .catch(error => {
        alert("Ошибка: " + error.message);
    });
}

function confirmEmergencyStop() {
    if(confirm("Вы уверены, что хотите выполнить аварийную остановку?")) {
        sendDroneCommand('emergency');
    }
}
</script>
{% endblock %}